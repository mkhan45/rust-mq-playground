<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Rust Macroquad Playground</title>
    <style>
        html,
        body,
        canvas {
            margin: 0px;
            padding: 0px;
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: absolute;
            background: black;
            z-index: 0;
        }

        button {
            border: none;
            padding: 4px;
            margin: 0;
            font-weight: bold;
            transition: all 0.125s ease 0s;
        }

        .compile-btn {
            background: rgb(245, 158, 11);
            color: black;
            width: 15ch;
        }

        .download-btn {
            background: rgb(31, 41, 55);
            color: white;
            width: 16ch;
            margin-left: -4px;
        }

        .compile-btn:hover, .download-btn:hover {
            background: black;
            color: rgb(245, 158, 11);
        }

        .error-btn {
            background: red;
            color: white;
            width: 16ch;
        }

        .error-btn:hover {
            background: #8B0000;
        }
    </style>
    <script src="https://pagecdn.io/lib/ace/1.4.14/ace.min.js"></script>
    <script src="https://pagecdn.io/lib/ace/1.4.14/mode-rust.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <!-- Minified and statically hosted version of https://github.com/not-fl3/macroquad/blob/master/js/mq_js_bundle.js -->
    <div class="columns" style="height: 100vh; margin: 0">
        <div class="column" style="padding: 0; background: white; width: 120ch">
            <div style="height: 4vh">
                <button 
                    id="compile-btn" onclick="compile_and_load()" class="compile-btn"
                >
                Compile
                </button>
                <button 
                    id="download-btn" onclick="downloadProject()" class="download-btn"
                >
                Download
                </button>
            </div>
            <div id="editor" style="height: 92vh">use macroquad::prelude::*;

struct MainState {
    ball: Rect,
    ball_vel: Vec2,
}

impl MainState {
    fn new() -> Self {
        MainState {
            ball: Rect::new(screen_width() / 2.0, screen_height() / 2.0, 20.0, 20.0),
            ball_vel: Vec2::new(2.0, 1.5),
        }
    }

    fn update(&mut self) {
        self.ball.x += self.ball_vel.x;
        self.ball.y += self.ball_vel.y;

        if self.ball.left() <= 0.0 
        || self.ball.right() >= screen_width() {
            self.ball_vel.x *= -1.0;
        }

        if self.ball.top() <= 0.0
        || self.ball.bottom() >= screen_height() {
            self.ball_vel.y *= -1.0;
        }
    }

    fn draw_rect(&self, rect: &Rect) {
        draw_rectangle(
            rect.x,
            rect.y,
            rect.w,
            rect.h,
            WHITE,
        )
    }

    fn draw(&self) {
        self.draw_rect(&self.ball);
    }
}

#[macroquad::main("Pong")]
async fn main() {
    let mut main_state = MainState::new();

    loop {
        clear_background(BLACK);
        main_state.update();
        main_state.draw();
        next_frame().await
    }
}
            </div>
            <button id="error-btn" class="error-btn"
                style="height: 4vh;" onclick="toggle_error_msg()">Show Error Panel</button>
            <div id="error-msg">
                <br>
                <div style="padding-left: 1em; height: 90%; overflow-y: scroll;">
                    <code id="error-body" 
                        style="white-space: pre-wrap; background: white;"
                    >
                    No errors
                    </code>
                </div>
            </div>
        </div>
        <div class="column" style="padding: 0">
            <canvas id="glcanvas" tabindex='1' style="width: 50vw"></canvas>
        </div>
    </div>

    <script src="https://not-fl3.github.io/miniquad-samples/mq_js_bundle.js"></script>
    <script src="/js/index.js"></script>
</body>
</html>
